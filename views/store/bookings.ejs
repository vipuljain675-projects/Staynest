<%- include('../partials/head') %>
<body class="bg-light">
<%- include('../partials/nav') %>

<main class="container py-5">
  <div class="text-center mb-5">
    <h1 class="fw-bold">Your Trips</h1>
    <p class="text-muted">Manage your upcoming adventures</p>
  </div>

  <% if (bookings.length > 0) { %>
    <div class="d-flex flex-column align-items-center gap-5">
      
      <% bookings.forEach(booking => { %>
        <div class="card border-0 shadow-lg rounded-4 overflow-hidden w-100" style="max-width: 850px;">
          
          <div class="bg-success text-white p-3 px-4 d-flex justify-content-between align-items-center">
              <div class="d-flex align-items-center gap-2">
                  <i class="bi bi-check-circle-fill fs-5"></i>
                  <span class="fw-bold text-uppercase" style="letter-spacing: 1px;">Confirmed</span>
              </div>
              <div class="small opacity-75">
                  Booked on <%= new Date().toLocaleDateString() %>
              </div>
          </div>

          <div class="row g-0">
              
              <div class="col-md-8 p-4 bg-white d-flex flex-column justify-content-between">
                  <div>
                    <h3 class="fw-bold mb-1"><%= booking.homeName %></h3>
                    <p class="text-muted small mb-4">
                       <i class="bi bi-geo-alt-fill me-1"></i> View on map
                    </p>

                    <div class="row mb-4">
                        <div class="col-6">
                            <small class="text-muted text-uppercase fw-bold" style="font-size: 0.7rem;">Check-in</small>
                            <div class="fs-5 fw-bold"><%= booking.checkIn.toLocaleDateString('en-US', { weekday: 'short', month: 'short', day: 'numeric' }) %></div>
                            <div class="small text-muted">12:00 PM</div>
                        </div>
                        <div class="col-6">
                            <small class="text-muted text-uppercase fw-bold" style="font-size: 0.7rem;">Check-out</small>
                            <div class="fs-5 fw-bold"><%= booking.checkOut.toLocaleDateString('en-US', { weekday: 'short', month: 'short', day: 'numeric' }) %></div>
                            <div class="small text-muted">11:00 AM</div>
                        </div>
                    </div>

                    <div class="d-flex gap-4">
                        <div>
                            <small class="text-muted text-uppercase fw-bold" style="font-size: 0.7rem;">Guests</small>
                            <div class="fw-bold">
                                <%= (booking.guests.adults || 1) + (booking.guests.children || 0) + (booking.guests.seniors || 0) %> People
                            </div>
                        </div>
                        <div>
                            <small class="text-muted text-uppercase fw-bold" style="font-size: 0.7rem;">Reference</small>
                            <div class="fw-bold font-monospace"><%= booking._id.toString().slice(-6).toUpperCase() %></div>
                        </div>
                    </div>
                  </div>

                  <div class="border-top pt-3 mt-4 d-flex justify-content-between align-items-center">
                      <div>
                          <small class="text-muted">Total Paid</small>
                          <div class="fs-4 fw-bold text-success">â‚¹<%= booking.totalPrice %></div>
                      </div>
                      
                      <form action="/cancel-booking" method="POST" onsubmit="return confirm('Are you sure you want to cancel this trip?');">
                        <input type="hidden" name="bookingId" value="<%= booking._id %>">
                        <button class="btn btn-outline-danger btn-sm rounded-pill px-3 fw-bold">
                            Cancel
                        </button>
                      </form>
                  </div>
              </div>

              <div class="col-md-4 bg-light p-4 d-flex flex-column align-items-center justify-content-center border-start text-center position-relative">
                  <div class="position-absolute start-0 top-0 bottom-0 border-start border-2 border-dashed" style="left: -1px;"></div>
                  
                  <img src="https://api.qrserver.com/v1/create-qr-code/?size=150x150&data=<%= booking._id %>" 
                       alt="QR Code" class="mb-3 mix-blend-multiply" style="width: 120px;">
                  
                  <div class="small text-muted fw-bold mb-1">Scan for Check-in</div>
                  <div class="badge bg-dark text-white rounded-pill px-3 py-2 mt-2">
                    Host: Super Host
                  </div>
              </div>

          </div>
        </div>
      <% }) %>

    </div>
  <% } else { %>
    
    <div class="text-center py-5">
      <div class="mb-3">
          <svg viewBox="0 0 32 32" width="64" height="64" fill="#dddddd"><path d="M16 2C8.3 2 2 8.3 2 16s6.3 14 14 14 14-6.3 14-14S23.7 2 16 2zm0 26C9.4 28 4 22.6 4 16S9.4 4 16 4s12 5.4 12 12-5.4 12-12 12z"></path><path d="M16 8a8 8 0 1 0 0 16 8 8 0 0 0 0-16z"></path></svg>
      </div>
      <h3 class="text-muted">No trips booked yet.</h3>
      <p class="text-muted mb-4">Time to dust off your bags and start planning your next adventure.</p>
      <a href="/homes" class="btn btn-primary rounded-pill px-5 py-3 fw-bold" style="background-color: #ff385c; border: none;">
        Start Exploring
      </a>
    </div>

  <% } %>
</main>

</body>
</html>