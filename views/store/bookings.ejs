<%- include('../partials/head') %>
<body class="bg-light">
<%- include('../partials/nav') %>

<main class="container mb-5" style="margin-top: 40px;">
  
  <h1 class="fw-bold mb-2">My Trips</h1>
  <p class="text-muted mb-5">Upcoming bookings and past getaways.</p>

  <% if (bookings.length === 0) { %>
    <div class="text-center py-5">
      <h3 class="fw-bold text-muted">No trips booked... yet!</h3>
      <a href="/homes" class="btn btn-primary mt-3">Explore Homes</a>
    </div>
  <% } else { %>

    <% bookings.forEach(b => { %>
      <div class="ticket-container">
        <div class="ticket">
          
          <div class="ticket-left ps-5"> <div class="ticket-info w-100">
              <div class="border-bottom pb-3 mb-3">
                <h2 class="fw-bold mb-1" style="color: #ff385c;"><%= b.homeName %></h2>
                <div class="text-muted fw-bold small">
                  CONFIRMED RESERVATION • AIRBNB STAY
                </div>
              </div>

              <div class="row">
                <div class="col-md-3 col-6 mb-3">
                  <div class="ticket-label">CHECK-IN</div>
                  <div class="ticket-value text-dark">
                    <%= new Date(b.checkIn).toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' }) %>
                  </div>
                </div>

                <div class="col-md-3 col-6 mb-3">
                  <div class="ticket-label">CHECK-OUT</div>
                  <div class="ticket-value text-dark">
                    <%= new Date(b.checkOut).toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' }) %>
                  </div>
                </div>

                <div class="col-md-3 col-6 mb-3">
                  <div class="ticket-label">GUESTS</div>
                  <div class="ticket-value">
                     <%= (b.guests.adults || 0) + (b.guests.children || 0) + (b.guests.seniors || 0) %> Total
                  </div>
                </div>
                
                <div class="col-md-3 col-6 mb-3">
                  <div class="ticket-label">DETAILS</div>
                  <div class="fw-bold small text-muted">
                    <%= b.guests.adults %> Adults
                    <% if(b.guests.children > 0) { %>, <%= b.guests.children %> Kids <% } %>
                    <% if(b.guests.seniors > 0) { %>, <%= b.guests.seniors %> Seniors <% } %>
                  </div>
                </div>

              </div>
            </div>
          </div>

          <div class="ticket-right border-start">
            <div class="ticket-label">TOTAL PAID</div>
            <h3 class="fw-bold text-dark mb-4">₹<%= b.totalPrice %></h3>
            
            <div class="barcode"></div>
            
            <form action="/bookings/delete" method="POST" class="w-100">
              <input type="hidden" name="bookingId" value="<%= b._id %>">
              <button class="btn btn-outline-danger btn-sm w-100 rounded-pill fw-bold">
                Cancel Trip
              </button>
            </form>
          </div>

        </div>
      </div>
    <% }) %>
    
  <% } %>

</main>
</body>
</html>