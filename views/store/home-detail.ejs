<%- include('../partials/head') %>
<body class="bg-white">
<%- include('../partials/nav') %>

<main class="container mb-5" style="margin-top: 24px;">

  <div class="mb-4">
    <h1 class="listing-title"><%= home.houseName %></h1>
    <div class="d-flex gap-2 text-muted small fw-bold">
      <span>★ <%= home.rating %></span>
      <span>•</span>
      <span class="text-decoration-underline"><%= home.location %></span>
    </div>
  </div>

  <div class="photo-grid">
    <img src="<%= home.photoUrl[0] %>" class="photo-main" alt="Main Photo">
    
    <div class="photo-col">
      <img src="<%= home.photoUrl[1] || home.photoUrl[0] %>" class="photo-sub" alt="Photo 2">
      <img src="<%= home.photoUrl[2] || home.photoUrl[0] %>" class="photo-sub" alt="Photo 3">
    </div>
  </div>


  <div class="row">
    
    <div class="col-lg-8 pe-lg-5">
      
      <div class="d-flex align-items-center justify-content-between py-4 border-bottom">
        <div>
          <h4 class="fw-bold mb-1">Entire home hosted by <%= home.userId.firstName %></h4>
          <p class="text-muted mb-0">4 guests • 2 bedrooms • 2 beds • 2 baths</p>
        </div>
        <div class="rounded-circle bg-dark text-white d-flex align-items-center justify-content-center shadow-sm" 
             style="width: 56px; height: 56px; font-size: 1.5rem; font-weight: bold;">
          <%= home.userId.firstName.charAt(0) %>
        </div>
      </div>

      <div class="py-4 border-bottom">
        <div class="d-flex gap-3 mb-3">
          <svg viewBox="0 0 32 32" width="24" height="24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 10a2 2 0 0 1 2-2h22a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V10z"></path><path d="M13 2v6M19 2v6"></path></svg>
          <div>
            <div class="fw-bold">Designed by experts</div>
            <div class="text-muted small">This home is unique and stylish.</div>
          </div>
        </div>
        <div class="d-flex gap-3">
          <svg viewBox="0 0 32 32" width="24" height="24" fill="none" stroke="currentColor" stroke-width="2"><path d="M16 29L3 16 16 3l13 13-13 13z"></path></svg>
          <div>
            <div class="fw-bold">Self check-in</div>
            <div class="text-muted small">Check yourself in with the keypad.</div>
          </div>
        </div>
      </div>

      <div class="py-4 border-bottom">
        <p class="lh-lg" style="font-size: 1rem;"><%= home.description %></p>
      </div>

      <div class="py-4 border-bottom">
        <h4 class="fw-bold mb-4">What this place offers</h4>
        <div class="row">
          <div class="col-md-6 amenity-item"><i class="bi bi-wifi"></i> Wifi</div>
          <div class="col-md-6 amenity-item"><i class="bi bi-car-front"></i> Free parking</div>
          <div class="col-md-6 amenity-item"><i class="bi bi-water"></i> Pool</div>
          <div class="col-md-6 amenity-item"><i class="bi bi-tv"></i> TV</div>
          <div class="col-md-6 amenity-item"><i class="bi bi-snow"></i> Air conditioning</div>
          <div class="col-md-6 amenity-item"><i class="bi bi-cup-hot"></i> Coffee maker</div>
        </div>
      </div>

      <div class="py-4">
        <h4 class="fw-bold mb-3">Where you'll be</h4>
        <div id="map" class="rounded-4" style="height: 400px; border: 1px solid #e0e0e0;"></div>
      </div>

    </div>

    <div class="col-lg-4">
      <div class="booking-card">
        
        <div class="d-flex justify-content-between align-items-baseline mb-3">
          <div><span class="price-text">₹<%= home.price %></span> <span class="text-muted">night</span></div>
          <div class="small fw-bold">★ <%= home.rating %> <span class="text-muted text-decoration-underline">· 18 reviews</span></div>
        </div>

        <div class="border rounded-3 mb-3">
          <div class="d-flex border-bottom">
            <div class="p-2 w-50 border-end">
              <div class="text-uppercase fw-bold" style="font-size: 0.6rem;">Check-in</div>
              <div class="small">Add date</div>
            </div>
            <div class="p-2 w-50">
              <div class="text-uppercase fw-bold" style="font-size: 0.6rem;">Checkout</div>
              <div class="small">Add date</div>
            </div>
          </div>
          <div class="p-2">
            <div class="text-uppercase fw-bold" style="font-size: 0.6rem;">Guests</div>
            <div class="small">1 guest</div>
          </div>
        </div>

        <a href="/reserve/<%= home._id %>" class="btn btn-primary w-100 py-3 fw-bold mb-3" style="background: #ff385c; border: none; font-size: 1.1rem;">
          Reserve
        </a>
        
        <div class="text-center text-muted small mb-3">You won't be charged yet</div>

        <div class="d-flex justify-content-between mb-2">
          <span class="text-decoration-underline">₹<%= home.price %> x 5 nights</span>
          <span>₹<%= home.price * 5 %></span>
        </div>
        <div class="d-flex justify-content-between mb-3 pb-3 border-bottom">
          <span class="text-decoration-underline">Airbnb service fee</span>
          <span>₹2,500</span>
        </div>
         <div class="d-flex justify-content-between fw-bold">
          <span>Total before taxes</span>
          <span>₹<%= (home.price * 5) + 2500 %></span>
        </div>
        
        <form action="/favourite" method="POST" class="mt-4 text-center">
            <input type="hidden" name="homeId" value="<%= home._id %>">
            <button class="btn btn-link text-muted text-decoration-underline fw-bold btn-sm">
             <svg viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg" style="display:inline-block;height:16px;width:16px;fill:currentColor; margin-right:5px;"><path d="M16 28c7-4.73 14-10 14-17a6.98 6.98 0 0 0-7-7c-1.8 0-3.58.68-4.95 2.05L16 8.1l-2.05-2.05a6.98 6.98 0 0 0-9.9 0A6.98 6.98 0 0 0 2 11c0 7 7 12.27 14 17z"></path></svg>
             Save to Wishlist
            </button>
        </form>

      </div>
    </div>

  </div>
</main>

<script>
  fetch('https://nominatim.openstreetmap.org/search?format=json&q=<%= home.location %>')
    .then(res => res.json())
    .then(data => {
      if (!data || data.length === 0) return;
      const lat = data[0].lat;
      const lon = data[0].lon;
      const map = L.map('map', { scrollWheelZoom: false }).setView([lat, lon], 13);
      L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: '&copy; OpenStreetMap'
      }).addTo(map);
      L.circle([lat, lon], {
          color: '#ff385c',
          fillColor: '#ff385c',
          fillOpacity: 0.2,
          radius: 500
      }).addTo(map);
    });
</script>

</body>
</html>